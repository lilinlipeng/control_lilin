{"version":3,"file":"BatchRecordForm.js","sources":["pages/Front/BatchRecordForm.vue","../../HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvRnJvbnQvQmF0Y2hSZWNvcmRGb3JtLnZ1ZQ"],"sourcesContent":["<template>\r\n    <view>\r\n        <!-- 导航栏 -->\r\n        <uni-nav-bar dark :fixed=\"true\" shadow background-color=\"var(--primary-color)\" status-bar left-icon=\"left\"\r\n            title=\"批量录入数据\" @clickLeft=\"goBack\" />\r\n\r\n        <!-- 页面内容 -->\r\n        <view class=\"page-content\">\r\n            <!-- 头部信息 -->\r\n            <view class=\"header-info\">\r\n                <view class=\"info-card\">\r\n                    <view class=\"info-icon\">\r\n                        <uni-icons type=\"list\" size=\"20\" color=\"#4CAF50\"></uni-icons>\r\n                    </view>\r\n                    <view class=\"info-text\">\r\n                        <view class=\"info-title\">共 {{ indicatorList.length }} 项指标待录入</view>\r\n                        <view class=\"info-subtitle\">请填写各项指标的测量值</view>\r\n                    </view>\r\n                </view>\r\n            </view>\r\n\r\n            <!-- 录入表单 -->\r\n            <view class=\"form-container\">\r\n                <view v-for=\"(indicator, index) in indicatorList\" :key=\"indicator.Id\" class=\"form-item\">\r\n                    <!-- 指标信息 -->\r\n                    <view class=\"indicator-info\">\r\n                        <view class=\"indicator-header\">\r\n                            <view class=\"indicator-icon\">\r\n                                <image v-if=\"indicator.Cover\" :src=\"indicator.Cover\" class=\"icon-image\" mode=\"aspectFit\">\r\n                                </image>\r\n                                <uni-icons v-else type=\"pulse\" size=\"20\" color=\"#4CAF50\"></uni-icons>\r\n                            </view>\r\n                            <view class=\"indicator-details\">\r\n                                <view class=\"indicator-name\">{{ indicator.Name }}</view>\r\n                                <view class=\"indicator-category\">{{ indicator.HealthIndicatorTypeName }}</view>\r\n                                <view class=\"indicator-threshold\">正常范围: {{ indicator.Threshold }}</view>\r\n                            </view>\r\n                        </view>\r\n                        <view class=\"indicator-description\">{{ indicator.Content }}</view>\r\n                    </view>\r\n\r\n                    <!-- 数据录入区域 -->\r\n                    <view class=\"input-section\">\r\n                        <view class=\"input-group\">\r\n                            <view class=\"input-label\">测量值</view>\r\n                            <view class=\"input-wrapper\">\r\n                                <input type=\"number\" class=\"data-input\" placeholder=\"请输入测量值\"\r\n                                    v-model=\"recordData[index].RecordValue\" @input=\"checkAbnormity(index)\" />\r\n                                <view class=\"unit-text\">{{ getUnit(indicator.Threshold) }}</view>\r\n                            </view>\r\n                        </view>\r\n\r\n                        <view class=\"input-group\">\r\n                            <view class=\"input-label\">记录时间</view>\r\n                            <view class=\"input-wrapper\">\r\n                                <uni-datetime-picker type=\"datetime\" v-model=\"recordData[index].RecordTime\"\r\n                                    :clear-icon=\"false\">\r\n                                    <view class=\"time-input\">\r\n                                        {{ formatDateTime(recordData[index].RecordTime) || '点击选择时间' }}\r\n                                    </view>\r\n                                </uni-datetime-picker>\r\n                            </view>\r\n                        </view>\r\n\r\n                        <!-- 异常状态提示 -->\r\n                        <view v-if=\"recordData[index].IsAbnormity\" class=\"abnormity-tip\">\r\n                            <uni-icons type=\"info-filled\" size=\"16\" color=\"#FF9800\"></uni-icons>\r\n                            <text class=\"tip-text\">测量值超出正常范围</text>\r\n                        </view>\r\n                    </view>\r\n                </view>\r\n            </view>\r\n\r\n            <!-- 提交按钮 -->\r\n            <view class=\"submit-section\">\r\n                <button class=\"submit-btn\" @click=\"submitRecords\" :disabled=\"!isFormValid\">\r\n                    提交数据 ({{ validRecordsCount }}/{{ indicatorList.length }})\r\n                </button>\r\n            </view>\r\n        </view>\r\n    </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { useCommonStore } from '@/store';\r\nimport { Post } from '@/utils/http';\r\nimport { onLoad } from \"@dcloudio/uni-app\";\r\nimport { computed, reactive, ref } from 'vue';\r\nimport { GetFormatFullDate } from '@/utils/comm';\r\n\r\n// 获取store\r\nconst commonStore = useCommonStore();\r\nconst Token = computed(() => commonStore.Token)\r\nconst UserInfo = computed(() => commonStore.UserInfo)\r\nconst UserId = computed(() => commonStore.UserId)\r\n\r\n// 页面数据\r\nconst indicatorList = ref([]); // 指标列表\r\nconst recordData = ref([]); // 录入数据\r\n\r\n// 页面加载\r\nonLoad(async (option) => {\r\n\r\n    try {\r\n        indicatorList.value = JSON.parse(uni.getStorageSync('selectedIndicators'));\r\n        initRecordData();\r\n    } catch (error) {\r\n        console.error('解析指标数据失败:', error);\r\n        uni.showToast({\r\n            title: '数据解析失败',\r\n            icon: 'error'\r\n        });\r\n        setTimeout(() => {\r\n            uni.navigateBack();\r\n        }, 1500);\r\n    }\r\n\r\n});\r\n\r\n// 初始化录入数据\r\nconst initRecordData = () => {\r\n    recordData.value = indicatorList.value.map(indicator => ({\r\n        HealthIndicatorTypeId: indicator.HealthIndicatorTypeId,\r\n        HealthIndicatorId: indicator.Id,\r\n        RecordUserId: UserId.value,\r\n        RecordTime: GetFormatFullDate(new Date()),\r\n        RecordValue: '',\r\n        IsAbnormity: false\r\n    }));\r\n};\r\n\r\n// 检查异常状态\r\nconst checkAbnormity = (index) => {\r\n    const record = recordData.value[index];\r\n    const indicator = indicatorList.value[index];\r\n\r\n    if (!record.RecordValue || !indicator.Threshold) {\r\n        record.IsAbnormity = false;\r\n        return;\r\n    }\r\n\r\n    const value = parseFloat(record.RecordValue);\r\n    const threshold = indicator.Threshold;\r\n\r\n    // 解析正常范围\r\n    if (threshold.includes('-')) {\r\n        const [min, max] = threshold.split('-').map(v => parseFloat(v.trim()));\r\n        record.IsAbnormity = value < min || value > max;\r\n    } else if (threshold.includes('>')) {\r\n        const min = parseFloat(threshold.replace('>', '').trim());\r\n        record.IsAbnormity = value <= min;\r\n    } else if (threshold.includes('<')) {\r\n        const max = parseFloat(threshold.replace('<', '').trim());\r\n        record.IsAbnormity = value >= max;\r\n    } else {\r\n        record.IsAbnormity = false;\r\n    }\r\n};\r\n\r\n// 获取单位\r\nconst getUnit = (threshold) => {\r\n    // 从阈值字符串中提取单位\r\n    const units = ['ml', 'mg/dl', 'mmol/L', 'mIU/L', 'pmol/L', '%', 'bpm', 'mmHg'];\r\n    for (const unit of units) {\r\n        if (threshold.includes(unit)) {\r\n            return unit;\r\n        }\r\n    }\r\n    return '';\r\n};\r\n\r\n// 格式化日期时间\r\nconst formatDateTime = (dateTime) => {\r\n    if (!dateTime) return '';\r\n    const date = new Date(dateTime);\r\n    return date.toLocaleString('zh-CN', {\r\n        year: 'numeric',\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n    });\r\n};\r\n\r\n// 计算有效记录数量\r\nconst validRecordsCount = computed(() => {\r\n    return recordData.value.filter(record => record.RecordValue && record.RecordTime).length;\r\n});\r\n\r\n// 表单验证\r\nconst isFormValid = computed(() => {\r\n    return validRecordsCount.value > 0;\r\n});\r\n\r\n// 提交记录\r\nconst submitRecords = async () => {\r\n    if (!isFormValid.value) {\r\n        uni.showToast({\r\n            title: '请至少填写一项数据',\r\n            icon: 'none'\r\n        });\r\n        return;\r\n    }\r\n\r\n    try {\r\n        uni.showLoading({ title: '提交中...' });\r\n\r\n        // 过滤有效数据\r\n        const validRecords = recordData.value.filter(record =>\r\n            record.RecordValue && record.RecordTime\r\n        ).map(record => ({\r\n            ...record,\r\n            RecordValue: parseFloat(record.RecordValue),\r\n            IsAbnormity: record.IsAbnormity ? 'Y' : 'N'\r\n        }));\r\n\r\n        // 批量提交数据\r\n        const { Success } = await Post('/HealthIndicatorRecord/BatchAdd', validRecords);\r\n\r\n        uni.hideLoading();\r\n\r\n        if (Success) {\r\n            uni.showToast({\r\n                title: '提交成功',\r\n                icon: 'success'\r\n            });\r\n            setTimeout(() => {\r\n                uni.navigateBack();\r\n            }, 1500);\r\n        }\r\n    } catch (error) {\r\n        uni.hideLoading();\r\n        console.error('提交失败:', error);\r\n        uni.showToast({\r\n            title: '提交失败',\r\n            icon: 'error'\r\n        });\r\n    }\r\n};\r\n\r\n// 返回上一页\r\nconst goBack = () => {\r\n    uni.navigateBack();\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n/* 页面内容区域 */\r\n.page-content {\r\n    padding: 10rpx 24rpx 140rpx;\r\n    min-height: 100vh;\r\n    background-color: #f5f5f5;\r\n}\r\n\r\n/* 头部信息卡片 */\r\n.header-info {\r\n    margin-bottom: 32rpx;\r\n}\r\n\r\n.info-card {\r\n    display: flex;\r\n    align-items: center;\r\n    background: #ffffff;\r\n    border-radius: 16rpx;\r\n    padding: 24rpx;\r\n    box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.info-icon {\r\n    width: 60rpx;\r\n    height: 60rpx;\r\n    background: #f0f8f0;\r\n    border-radius: 50%;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    margin-right: 20rpx;\r\n}\r\n\r\n.info-text {\r\n    flex: 1;\r\n}\r\n\r\n.info-title {\r\n    font-size: 28rpx;\r\n    font-weight: 600;\r\n    color: #333333;\r\n    margin-bottom: 4rpx;\r\n}\r\n\r\n.info-subtitle {\r\n    font-size: 24rpx;\r\n    color: #666666;\r\n}\r\n\r\n/* 表单容器 */\r\n.form-container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 24rpx;\r\n    padding: 0px;\r\n}\r\n\r\n/* 表单项 */\r\n.form-item {\r\n    background: #ffffff;\r\n    border-radius: 16rpx;\r\n    padding: 24rpx;\r\n    box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.08);\r\n}\r\n\r\n/* 指标信息区域 */\r\n.indicator-info {\r\n    margin-bottom: 24rpx;\r\n    padding-bottom: 20rpx;\r\n    border-bottom: 2rpx solid #f0f0f0;\r\n}\r\n\r\n.indicator-header {\r\n    display: flex;\r\n    align-items: flex-start;\r\n    margin-bottom: 12rpx;\r\n}\r\n\r\n.indicator-icon {\r\n    width: 60rpx;\r\n    height: 60rpx;\r\n    background: #f0f8f0;\r\n    border-radius: 12rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    margin-right: 16rpx;\r\n    flex-shrink: 0;\r\n}\r\n\r\n.icon-image {\r\n    width: 40rpx;\r\n    height: 40rpx;\r\n    border-radius: 8rpx;\r\n}\r\n\r\n.indicator-details {\r\n    flex: 1;\r\n}\r\n\r\n.indicator-name {\r\n    font-size: 28rpx;\r\n    font-weight: 600;\r\n    color: #333333;\r\n    margin-bottom: 4rpx;\r\n}\r\n\r\n.indicator-category {\r\n    font-size: 22rpx;\r\n    color: #888888;\r\n    margin-bottom: 4rpx;\r\n}\r\n\r\n.indicator-threshold {\r\n    font-size: 24rpx;\r\n    color: #4CAF50;\r\n    font-weight: 500;\r\n}\r\n\r\n.indicator-description {\r\n    font-size: 24rpx;\r\n    color: #666666;\r\n    line-height: 1.5;\r\n}\r\n\r\n/* 输入区域 */\r\n.input-section {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 20rpx;\r\n}\r\n\r\n.input-group {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 8rpx;\r\n}\r\n\r\n.input-label {\r\n    font-size: 26rpx;\r\n    font-weight: 600;\r\n    color: #333333;\r\n}\r\n\r\n.input-wrapper {\r\n    display: flex;\r\n    align-items: center;\r\n    background: #f8f8f8;\r\n    border-radius: 12rpx;\r\n    padding: 16rpx;\r\n    border: 2rpx solid transparent;\r\n    transition: border-color 0.3s ease;\r\n\r\n    &:focus-within {\r\n        border-color: #4CAF50;\r\n        background: #ffffff;\r\n    }\r\n}\r\n\r\n.data-input {\r\n    flex: 1;\r\n    font-size: 28rpx;\r\n    color: #333333;\r\n    background: transparent;\r\n    border: none;\r\n    outline: none;\r\n}\r\n\r\n.unit-text {\r\n    font-size: 24rpx;\r\n    color: #888888;\r\n    margin-left: 12rpx;\r\n}\r\n\r\n.time-input {\r\n    flex: 1;\r\n    font-size: 28rpx;\r\n    color: #333333;\r\n    padding: 4rpx 0;\r\n}\r\n\r\n/* 异常提示 */\r\n.abnormity-tip {\r\n    display: flex;\r\n    align-items: center;\r\n    background: #fff3e0;\r\n    border: 2rpx solid #ffcc80;\r\n    border-radius: 8rpx;\r\n    padding: 12rpx 16rpx;\r\n    margin-top: 8rpx;\r\n}\r\n\r\n.tip-text {\r\n    font-size: 24rpx;\r\n    color: #FF9800;\r\n    margin-left: 8rpx;\r\n}\r\n\r\n/* 提交区域 */\r\n.submit-section {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    padding: 20rpx 24rpx;\r\n    background: #ffffff;\r\n    box-shadow: 0 -4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.submit-btn {\r\n    width: 100%;\r\n    height: 88rpx;\r\n    background: linear-gradient(135deg, #4CAF50, #45a049);\r\n    border-radius: 16rpx;\r\n    font-size: 32rpx;\r\n    font-weight: 600;\r\n    color: #ffffff;\r\n    border: none;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    box-shadow: 0 4rpx 16rpx rgba(76, 175, 80, 0.3);\r\n    transition: all 0.3s ease;\r\n\r\n    &:active {\r\n        transform: scale(0.98);\r\n        opacity: 0.9;\r\n    }\r\n\r\n    &[disabled] {\r\n        background: #cccccc;\r\n        box-shadow: none;\r\n        opacity: 0.6;\r\n    }\r\n}\r\n</style> ","import MiniProgramPage from 'F:/workspace/HealthControl.uniapp/pages/Front/BatchRecordForm.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCommonStore","computed","ref","onLoad","uni","GetFormatFullDate","Post"],"mappings":"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"}