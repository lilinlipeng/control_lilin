{"version":3,"file":"http.js","sources":["utils/http.js"],"sourcesContent":["import { GetLoginToken } from \"./cache\";\r\n//请求后端接口的根路径\r\nlet baseUrl = import.meta.env.VITE_API_BASE_URL;\r\n\r\n/**\r\n * 发送一个post请求给后端\r\n * @param {Object} url 请求的路径\r\n * @param {Object} data 请求的数据\r\n */\r\nexport async function Post(url, data) {\r\n  let response = {\r\n    Code: \"\",\r\n    Data: \"\",\r\n    Msg: \"\",\r\n    Success: true,\r\n  };\r\n  let header = {};\r\n  // 直接从本地存储获取token\r\n  const token = GetLoginToken();\r\n  if (token) {\r\n    header = {\r\n      Authorization: `Bearer ${token}`,\r\n    };\r\n  }\r\n  await Request({\r\n    url: baseUrl + url,\r\n    data: data,\r\n    method: \"POST\",\r\n    header: header,\r\n    dataType: \"json\",\r\n  })\r\n    .then((res) => {\r\n      response.Success = res.Success;\r\n      response.Msg = res.Msg;\r\n      response.Code = res.Code;\r\n      response.Data = res.Data;\r\n    })\r\n    .catch((err) => {\r\n      response.Success = false;\r\n      response.Msg = err;\r\n    });\r\n\r\n  return response;\r\n}\r\n\r\n/**\r\n * 更新某个表的字段请求\r\n * @param {*} getUrl 单个查询后端地址\r\n * @param {*} saveUrl 保存或者修改后端地址\r\n * @param {*} id  需要修改的数据id\r\n * @param {*} content 修改的内容提示\r\n * @param {*} obj  修改的数据\r\n * @returns\r\n */\r\nexport async function PostSigleUpdate(getUrl, saveUrl, id, content, obj) {\r\n  let confirm = await uni.showModal({\r\n    title: \"提示\",\r\n    content: content,\r\n  });\r\n\r\n  if (confirm) {\r\n    let { Data } = await PostAsync(getUrl, {\r\n      Id: id,\r\n    });\r\n    Data = {\r\n      ...Data,\r\n      ...obj,\r\n    };\r\n    return await PostAsync(saveUrl, Data);\r\n  }\r\n\r\n  return {\r\n    Success: false,\r\n    Msg: \"用户取消操作\",\r\n  };\r\n}\r\n\r\n/**\r\n * 发送一个post请求给后端 并且返回上一个页面\r\n * @param {Object} url 请求的路径\r\n * @param {Object} data 请求的数据\r\n */\r\nexport async function PostReturnPage(url, body) {\r\n  let response = await PostAsync(url, body);\r\n  let { success, data, message } = response;\r\n  if (success) {\r\n    uni.showToast({\r\n      icon: \"none\",\r\n      title: \"操作成功\",\r\n      duration: 1500,\r\n    });\r\n    setTimeout(() => {\r\n      uni.navigateBack({\r\n        delta: 1,\r\n      });\r\n    }, 1500);\r\n  } else {\r\n    uni.showToast({\r\n      icon: \"error\",\r\n      title: message,\r\n      duration: 1500,\r\n    });\r\n  }\r\n  return response;\r\n}\r\n\r\nexport var Request = function (option) {\r\n  return new Promise((resolve, reject) => {\r\n    uni.request({\r\n      url: option.url,\r\n      data: option.data,\r\n      method: option.method,\r\n      header: option.header,\r\n      dataType: option.dataType,\r\n      success: async (res) => {\r\n        if (res.statusCode == 404) {\r\n          uni.showToast({\r\n            icon: \"none\",\r\n            duration: 3000,\r\n            title: \"请求的资源不存在404!\",\r\n          });\r\n          reject(\"请求的资源不存在404!\");\r\n        } else if (res.statusCode == 500) {\r\n          uni.showToast({\r\n            icon: \"none\",\r\n            duration: 3000,\r\n            title: \"服务后端出小差了!\",\r\n          });\r\n          reject(\"服务后端出小差了!\");\r\n        } else if (res.statusCode == 200) {\r\n          let {\r\n            data: { Code, Msg, Success },\r\n          } = res;\r\n\r\n          if (Code == \"401\") {\r\n            //如果没有授权 直接丢弃当前Token\r\n            await store.dispatch(\"TokenLose\", {});\r\n            reject(\"你没有权限访问\");\r\n          } else if (Code == \"500\") {\r\n            uni.showToast({\r\n              icon: \"none\",\r\n              duration: 3000,\r\n              title: Msg,\r\n            });\r\n            reject(Msg);\r\n          }\r\n\r\n          resolve(res.data);\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        console.log(err);\r\n        reject(err);\r\n      },\r\n    });\r\n  });\r\n};\r\n\r\nexport var Upload = function (filePath) {\r\n  return new Promise((resolve, reject) => {\r\n    const uploadTask = uni.uploadFile({\r\n      url: baseUrl + \"/File/BatchUpload\",\r\n      filePath: filePath,\r\n      name: \"file\",\r\n      success: (uploadFileRes) => {\r\n        resolve(JSON.parse(uploadFileRes.data));\r\n      },\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * 从相机或则拍摄图片\r\n */\r\nexport var UploadImageByCamera = function (count = 1) {\r\n  return new Promise((resolve, reject) => {\r\n    uni.chooseImage({\r\n      count: count,\r\n      sizeType: [\"original\", \"compressed\"],\r\n      sourceType: [\"album\", \"camera\"],\r\n      success: async (res) => {\r\n        let { tempFilePaths } = res;\r\n        //循环上传图片\r\n        let fileList = [];\r\n        for (let i = 0; i < tempFilePaths.length; i++) {\r\n          let response = await Upload(tempFilePaths[i]);\r\n          fileList.push(response.Data[0]);\r\n        }\r\n        resolve(fileList);\r\n      },\r\n    });\r\n  });\r\n};\r\n"],"names":["GetLoginToken","uni"],"mappings":";;;AAEA,IAAI,UAAU;AAOQ,eAAA,KAAK,KAAK,MAAM;AACpC,MAAI,WAAW;AAAA,IACb,MAAM;AAAA,IACN,MAAM;AAAA,IACN,KAAK;AAAA,IACL,SAAS;AAAA,EAAA;AAEX,MAAI,SAAS,CAAA;AAEb,QAAM,QAAQA,YAAAA;AACd,MAAI,OAAO;AACA,aAAA;AAAA,MACP,eAAe,UAAU,KAAK;AAAA,IAAA;AAAA,EAElC;AACA,QAAM,QAAQ;AAAA,IACZ,KAAK,UAAU;AAAA,IACf;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,IACA,UAAU;AAAA,EAAA,CACX,EACE,KAAK,CAAC,QAAQ;AACb,aAAS,UAAU,IAAI;AACvB,aAAS,MAAM,IAAI;AACnB,aAAS,OAAO,IAAI;AACpB,aAAS,OAAO,IAAI;AAAA,EAAA,CACrB,EACA,MAAM,CAAC,QAAQ;AACd,aAAS,UAAU;AACnB,aAAS,MAAM;AAAA,EAAA,CAChB;AAEI,SAAA;AACT;AA+DW,IAAA,UAAU,SAAU,QAAQ;AACrC,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCC,kBAAAA,MAAI,QAAQ;AAAA,MACV,KAAK,OAAO;AAAA,MACZ,MAAM,OAAO;AAAA,MACb,QAAQ,OAAO;AAAA,MACf,QAAQ,OAAO;AAAA,MACf,UAAU,OAAO;AAAA,MACjB,SAAS,OAAO,QAAQ;AAClB,YAAA,IAAI,cAAc,KAAK;AACzBA,wBAAAA,MAAI,UAAU;AAAA,YACZ,MAAM;AAAA,YACN,UAAU;AAAA,YACV,OAAO;AAAA,UAAA,CACR;AACD,iBAAO,cAAc;AAAA,QAAA,WACZ,IAAI,cAAc,KAAK;AAChCA,wBAAAA,MAAI,UAAU;AAAA,YACZ,MAAM;AAAA,YACN,UAAU;AAAA,YACV,OAAO;AAAA,UAAA,CACR;AACD,iBAAO,WAAW;AAAA,QAAA,WACT,IAAI,cAAc,KAAK;AAC5B,cAAA;AAAA,YACF,MAAM,EAAE,MAAM,KAAK,QAAQ;AAAA,UACzB,IAAA;AAEJ,cAAI,QAAQ,OAAO;AAEjB,kBAAM,MAAM,SAAS,aAAa,CAAE,CAAA;AACpC,mBAAO,SAAS;AAAA,UAAA,WACP,QAAQ,OAAO;AACxBA,0BAAAA,MAAI,UAAU;AAAA,cACZ,MAAM;AAAA,cACN,UAAU;AAAA,cACV,OAAO;AAAA,YAAA,CACR;AACD,mBAAO,GAAG;AAAA,UACZ;AAEA,kBAAQ,IAAI,IAAI;AAAA,QAClB;AAAA,MACF;AAAA,MACA,MAAM,CAAC,QAAQ;AACbA,sBAAAA,MAAA,MAAA,OAAA,wBAAY,GAAG;AACf,eAAO,GAAG;AAAA,MACZ;AAAA,IAAA,CACD;AAAA,EAAA,CACF;AACH;AAEW,IAAA,SAAS,SAAU,UAAU;AACtC,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACnBA,kBAAAA,MAAI,WAAW;AAAA,MAChC,KAAK,UAAU;AAAA,MACf;AAAA,MACA,MAAM;AAAA,MACN,SAAS,CAAC,kBAAkB;AAC1B,gBAAQ,KAAK,MAAM,cAAc,IAAI,CAAC;AAAA,MACxC;AAAA,IAAA,CACD;AAAA,EAAA,CACF;AACH;;;"}