{"version":3,"file":"DietRecordList.js","sources":["pages/Front/DietRecordList.vue","../../HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvRnJvbnQvRGlldFJlY29yZExpc3QudnVl"],"sourcesContent":["<template>\n    <view>\n        <!-- 导航栏 -->\n        <uni-nav-bar dark :fixed=\"true\" shadow background-color=\"var(--primary-color)\" status-bar left-icon=\"left\"\n            left-text=\"返回\" @clickLeft=\"goBack\" title=\"我的饮食记录\" />\n\n        <!-- 饮食记录列表内容区域 -->\n        <view>\n            <!-- 日历组件 -->\n            <view class=\"calendar-container\">\n                <uni-calendar :selected=\"selectedDates\" @change=\"onDateChange\" :lunar=\"false\" :start-date=\"startDate\"\n                    :end-date=\"endDate\" />\n            </view>\n\n            <!-- 选中日期显示 -->\n            <view class=\"selected-date\">\n                <text class=\"date-text\">{{ selectedDateText }}</text>\n            </view>\n\n            <!-- 饮食记录列表 -->\n            <view class=\"diet-records-container\" v-if=\"DietRecordList.length > 0\">\n                <!-- 遍历每个时段（早餐、午餐、晚餐等） -->\n                <view class=\"meal-section\" v-for=\"(mealGroup, index) in DietRecordList\" :key=\"index\">\n                    <!-- 时段标题 -->\n                    <view class=\"meal-header\">\n                        <view class=\"meal-title\">\n                            <text class=\"meal-name\">{{ mealGroup.DateType }}</text>\n                            <text class=\"meal-calories\">{{ mealGroup.TotalCalories }}千卡</text>\n                        </view>\n                        <view class=\"nutrition-info\">\n                            <text class=\"nutrition-item\">蛋白质: {{ mealGroup.TotalProtein }}g</text>\n                            <text class=\"nutrition-item\">碳水: {{ mealGroup.TotalCarbohydrates }}g</text>\n                            <text class=\"nutrition-item\">脂肪: {{ mealGroup.TotalFat }}g</text>\n                        </view>\n                    </view>\n\n                    <!-- 该时段的食物记录 -->\n                    <view class=\"food-records\">\n                        <view class=\"food-item\" v-for=\"record in mealGroup.DietRecords\" :key=\"record.Id\">\n                            <view class=\"food-info\">\n                                <image class=\"food-image\" :src=\"record.FoodDto.Cover\" mode=\"aspectFill\"></image>\n                                <view class=\"food-details\">\n                                    <text class=\"food-name\">{{ record.FoodDto.Name }}</text>\n                                    <text class=\"food-unit\">{{ record.RecordValue }}{{ record.FoodUnitDto.UnitName }}</text>\n                                    <text class=\"food-calories\">{{ record.FoodUnitDto.Calories }}千卡</text>\n                                    <text class=\"food-time\">{{ formatTime(record.RecordTime) }}</text>\n                                </view>\n                            </view>\n                            <view class=\"food-actions\">\n                                <uni-icons type=\"trash\" size=\"20\" color=\"#ff4757\"\n                                    @click=\"ShowDeleteModal(record.Id)\"></uni-icons>\n                            </view>\n                        </view>\n                    </view>\n                </view>\n            </view>\n\n            <!-- 空状态 -->\n            <view class=\"empty-state\" v-else>\n                <uni-icons type=\"calendar\" size=\"60\" color=\"#ccc\"></uni-icons>\n                <text class=\"empty-text\">该日期暂无饮食记录</text>\n                <text class=\"empty-hint\">点击右下角按钮添加记录</text>\n            </view>\n        </view>\n        <view style=\"height: 150upx;\"></view>\n\n        <!-- 浮动添加按钮 -->\n        <view class=\"floating-add-btn\" @click=\"goToAddRecord\">\n            <uni-icons type=\"plus\" size=\"24\" color=\"#fff\"></uni-icons>\n            <text class=\"btn-text\">添加</text>\n        </view>\n    </view>\n</template>\n\n<script setup>\n\nimport { useCommonStore } from '@/store';\nimport { Post } from '@/utils/http';\nimport { onLoad, onReady, onShow } from \"@dcloudio/uni-app\";\nimport { computed, reactive, ref } from 'vue';\n\n// 获取store\nconst commonStore = useCommonStore();\nconst Token = computed(() => commonStore.Token)\nconst UserInfo = computed(() => commonStore.UserInfo)\nconst RoleType = computed(() => commonStore.RoleType)\nconst UserId = computed(() => commonStore.UserId)\n\n// 日历相关数据\nconst selectedDates = ref([]);\nconst selectedDate = ref(new Date());\nconst startDate = ref('2020-01-01');\nconst endDate = ref('2030-12-31');\n\n// 计算选中日期的显示文本\nconst selectedDateText = computed(() => {\n    const date = selectedDate.value;\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}年${month}月${day}日`;\n});\n\n// 格式化日期为API需要的时间范围格式\nconst formatDateRangeForApi = (date) => {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n\n    // 返回当天的开始和结束时间\n    const startTime = `${year}-${month}-${day} 00:00:00`;\n    const endTime = `${year}-${month}-${day} 23:59:59`;\n\n    return [startTime, endTime];\n};\n\nconst TestInfoList = ref([]);\n\nconst where = reactive({\n    RecordUserId: UserId.value,\n    RecordTimeRange: formatDateRangeForApi(selectedDate.value), // 修改为时间范围参数\n});\n\n// 日历日期改变事件\nconst onDateChange = (event) => {\n    const { fulldate } = event;\n    selectedDate.value = new Date(fulldate);\n    selectedDates.value = [{ date: fulldate, info: '选中' }];\n\n    // 更新查询条件中的时间范围\n    where.RecordTimeRange = formatDateRangeForApi(selectedDate.value);\n\n    // 重新获取数据\n    GetDietRecordListApi();\n};\n\n// 生命周期钩子\nonLoad(async (option) => {\n    // 初始化选中今天的日期\n    const today = new Date();\n    selectedDate.value = today;\n    const todayFormatted = formatDateRangeForApi(today)[0].split(' ')[0]; // 获取日期部分用于日历显示\n    selectedDates.value = [{ date: todayFormatted, info: '选中' }];\n    where.RecordTimeRange = formatDateRangeForApi(today);\n});\n\nonShow(async () => {\n    GetDietRecordListApi();\n});\n\nonReady(async () => {\n\n});\n\n// 方法\nconst goBack = () => {\n    uni.navigateBack();\n};\n\n// 跳转到添加记录页面\nconst goToAddRecord = () => {\n    uni.navigateTo({\n        url: '/pages/Front/FoodList'\n    });\n};\n//显示今天的饮食记录，s按早中晚来显示我的记录\n//DietRecordByDay\nconst DietRecordList = ref([])\nconst GetDietRecordListApi = async () => {\n    let {\n        Data\n    } = await Post('/DietRecord/DietRecordByDay', where);\n    DietRecordList.value = Data || [];\n}\n\n// 删除\nconst ShowDeleteModal = async (Id) => {\n    uni.showModal({\n        title: '提示',\n        content: '确认删除该饮食记录吗？',\n        success: async (res) => {\n            if (res.confirm) {\n                const { Success } = await Post(`/DietRecord/Delete`, { Id: Id });\n                if (Success) {\n                    await GetDietRecordListApi();\n                    uni.showToast({\n                        title: '删除成功',\n                        icon: 'success'\n                    });\n                }\n            }\n        }\n    })\n};\n\n// 格式化时间\nconst formatTime = (timestamp) => {\n    const date = new Date(timestamp);\n    const hours = String(date.getHours()).padStart(2, '0');\n    const minutes = String(date.getMinutes()).padStart(2, '0');\n    return `${hours}:${minutes}`;\n};\n\n</script>\n\n<style scoped lang=\"scss\">\n/* 内容容器样式 */\n.content-container {\n    padding-top: 88rpx;\n    /* 为导航栏留出空间 */\n    padding-bottom: 120rpx;\n    /* 为浮动按钮留出空间 */\n    min-height: 100vh;\n    background-color: #f8f9fa;\n}\n\n/* 日历容器样式 */\n.calendar-container {\n    background-color: #fff;\n    margin: 20rpx;\n    border-radius: 16rpx;\n    box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n    overflow: hidden;\n}\n\n/* 选中日期显示 */\n.selected-date {\n    padding: 20rpx 40rpx;\n    background-color: #fff;\n    margin: 20rpx;\n    border-radius: 12rpx;\n    box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);\n}\n\n.date-text {\n    font-size: 32rpx;\n    font-weight: 600;\n    color: var(--primary-color);\n}\n\n/* 饮食记录容器 */\n.diet-records-container {\n    padding: 0 20rpx;\n}\n\n/* 用餐时段样式 */\n.meal-section {\n    background-color: #fff;\n    border-radius: 16rpx;\n    margin-bottom: 20rpx;\n    box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n    overflow: hidden;\n}\n\n.meal-header {\n    padding: 30rpx;\n    background-color: #fff;\n    border-bottom: 1rpx solid #f0f0f0;\n    color: #333;\n}\n\n.meal-title {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 15rpx;\n}\n\n.meal-name {\n    font-size: 36rpx;\n    font-weight: 600;\n    color: var(--primary-color);\n}\n\n.meal-calories {\n    font-size: 32rpx;\n    font-weight: 500;\n    color: #333;\n}\n\n.nutrition-info {\n    display: flex;\n    justify-content: space-between;\n}\n\n.nutrition-item {\n    font-size: 24rpx;\n    color: #666;\n}\n\n/* 食物记录样式 */\n.food-records {\n    padding: 0;\n}\n\n.food-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 30rpx;\n    border-bottom: 1rpx solid #f0f0f0;\n}\n\n.food-item:last-child {\n    border-bottom: none;\n}\n\n.food-info {\n    display: flex;\n    align-items: center;\n    flex: 1;\n}\n\n.food-image {\n    width: 80rpx;\n    height: 80rpx;\n    border-radius: 12rpx;\n    margin-right: 20rpx;\n    background-color: #f5f5f5;\n}\n\n.food-details {\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n}\n\n.food-name {\n    font-size: 32rpx;\n    font-weight: 500;\n    color: #333;\n    margin-bottom: 8rpx;\n}\n\n.food-unit {\n    font-size: 28rpx;\n    color: #666;\n    margin-bottom: 8rpx;\n}\n\n.food-calories {\n    font-size: 26rpx;\n    color: var(--primary-color);\n    font-weight: 500;\n}\n\n.food-time {\n    font-size: 24rpx;\n    color: #999;\n    margin-top: 8rpx;\n}\n\n.food-actions {\n    padding: 10rpx;\n}\n\n/* 空状态样式 */\n.empty-state {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 100rpx 40rpx;\n    background-color: #fff;\n    margin: 20rpx;\n    border-radius: 16rpx;\n    box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n}\n\n.empty-text {\n    font-size: 32rpx;\n    color: #999;\n    margin-top: 30rpx;\n    margin-bottom: 10rpx;\n}\n\n.empty-hint {\n    font-size: 28rpx;\n    color: #ccc;\n}\n\n/* 浮动添加按钮样式 */\n.floating-add-btn {\n    position: fixed;\n    bottom: 30rpx;\n    right: 30rpx;\n    width: 100rpx;\n    height: 100rpx;\n    background-color: var(--primary-color);\n    border-radius: 50%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    box-shadow: 0 8rpx 16rpx rgba(0, 0, 0, 0.15);\n    z-index: 999;\n    transition: all 0.3s ease;\n}\n\n/* 按钮点击效果 */\n.floating-add-btn:active {\n    transform: scale(0.95);\n    box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.1);\n}\n\n/* 按钮文本样式 */\n.btn-text {\n    color: #fff;\n    font-size: 20rpx;\n    margin-top: 8rpx;\n    font-weight: 500;\n}\n</style>","import MiniProgramPage from 'F:/workspace/HealthControl.uniapp/pages/Front/DietRecordList.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCommonStore","computed","ref","reactive","onLoad","onShow","onReady","uni","Post"],"mappings":"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"}