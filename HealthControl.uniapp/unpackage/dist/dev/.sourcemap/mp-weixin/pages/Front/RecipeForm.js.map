{"version":3,"file":"RecipeForm.js","sources":["pages/Front/RecipeForm.vue","../../HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvRnJvbnQvUmVjaXBlRm9ybS52dWU"],"sourcesContent":["<template>\r\n    <view>\r\n        <uni-nav-bar dark :fixed=\"true\" shadow background-color=\"var(--primary-color)\" status-bar left-icon=\"left\"\r\n            left-text=\"返回\" @clickLeft=\"goBack\" title=\"食谱信息\" />\r\n\r\n        <uni-section title=\"请填写食谱信息\">\r\n            <view class=\"form-container\">\r\n\r\n                <uni-forms ref=\"editModalForm\" :model=\"formData\" :rules=\"editModalFormRules\" label-width='100'\r\n                    label-position='top'>\r\n                    <uni-forms-item label=\"标题\" required name=\"Title\">\r\n                        <uni-easyinput v-model=\"formData.Title\" placeholder=\"请输入标题\" primaryColor=\"var(--primary-color)\" />\r\n                    </uni-forms-item>\r\n\r\n                    <uni-forms-item label=\"封面\" required name=\"Cover\">\r\n                        <upload-images v-model=\"formData.Cover\">\r\n                        </upload-images>\r\n                    </uni-forms-item>\r\n                    <uni-forms-item label=\"详细图\" name=\"ImageUrls\">\r\n                        <upload-images v-model=\"formData.ImageUrls\">\r\n                        </upload-images>\r\n                    </uni-forms-item>\r\n                    <uni-forms-item label=\"视频\" name=\"VideoUrl\">\r\n                        <upload-video v-model=\"formData.VideoUrl\">\r\n                        </upload-video>\r\n                    </uni-forms-item>\r\n\r\n                    <uni-forms-item label=\"内容\" name=\"Content\">\r\n                        <rich-text-edit ref=\"ContentRichTextEditRef\" v-model=\"formData.Content\"></rich-text-edit>\r\n                    </uni-forms-item>\r\n                </uni-forms>\r\n                <button class=\"btn-primary\" @click=\"createOrEditAsync\">提交</button>\r\n            </view>\r\n\r\n        </uni-section>\r\n\r\n\r\n    </view>\r\n</template>\r\n\r\n<script setup>\r\n\r\nimport { useCommonStore } from '@/store';\r\nimport { Post } from \"@/utils/http\";\r\nimport { onLoad, onReady, onShow } from \"@dcloudio/uni-app\";\r\nimport { computed, nextTick, reactive, ref } from 'vue';\r\n\r\n// 获取store\r\nconst commonStore = useCommonStore();\r\nconst Token = computed(() => commonStore.Token)\r\nconst UserInfo = computed(() => commonStore.UserInfo)\r\nconst RoleType = computed(() => commonStore.RoleType)\r\nconst UserId = computed(() => commonStore.UserId)\r\n\r\n\r\n// 表单数据和规则\r\nconst formData = reactive({\r\n});\r\nconst editModalForm = ref(null);\r\n\r\nconst Id = ref(null);\r\nconst editModalFormRules = {\r\n    Title: {\r\n        rules: [\r\n            {\r\n                required: true,\r\n                errorMessage: '该项为必填项'\r\n            },\r\n\r\n        ]\r\n    },\r\n    RecipeTypeId: {\r\n        rules: [\r\n            {\r\n                required: true,\r\n                errorMessage: '该项为必填项'\r\n            },\r\n\r\n        ]\r\n    },\r\n    Cover: {\r\n        rules: [\r\n            {\r\n                required: true,\r\n                errorMessage: '该项为必填项'\r\n            },\r\n\r\n        ]\r\n    },\r\n\r\n};\r\n\r\nconst ContentRichTextEditRef = ref(null);\r\n\r\n\r\n// 生命周期钩子\r\nonLoad(async (option) => {\r\n    Id.value = option.Id;\r\n    ShowEditModal(Id.value);\r\n\r\n\r\n});\r\n\r\nonShow(async () => {\r\n    // 页面显示时的逻辑\r\n});\r\n\r\nonReady(async () => {\r\n\r\n\r\n});\r\n\r\n// 显示编辑对话框\r\nconst ShowEditModal = async (Id) => {\r\n\r\n    const { Data } = await Post(`/Recipe/Get`, { Id: Id });\r\n    if (!Id) {\r\n        Data.PublishUserId = UserId.value;\r\n        Data.AuditStatus = 1;\r\n        Data.ViewCount = 0;\r\n    }\r\n    Object.assign(formData, Data);\r\n\r\n\r\n\r\n    if (ContentRichTextEditRef.value) {\r\n        ContentRichTextEditRef.value.setContent(Data.Content);\r\n    }\r\n\r\n    nextTick(() => {\r\n        // 设置自定义表单校验规则，必须在节点渲染完毕后执行\r\n        editModalForm.value.setRules(editModalFormRules);\r\n    });\r\n};\r\n\r\n// 方法\r\nconst goBack = () => {\r\n    uni.navigateBack();\r\n};\r\n\r\n//地址选择回调\r\nconst AddressSelected = (data) => {\r\n    formData.Address = data.fullAddress;\r\n\r\n};\r\n\r\n// 创建或修改方法\r\nconst createOrEditAsync = async () => {\r\n    editModalForm.value.validate().then(res => {\r\n        uni.showModal({\r\n            title: \"提示\",\r\n            content: \"你确定要操作吗?\",\r\n            showCancel: true,\r\n            cancelText: \"取消\",\r\n            confirmText: \"确定\",\r\n            success: async (res) => {\r\n                if (res.confirm) {\r\n                    formData.Content = await ContentRichTextEditRef.value.getContent();\r\n                    if (!formData.Content) {\r\n                        uni.showToast({\r\n                            title: \"请输入内容\",\r\n                            icon: \"none\"\r\n                        });\r\n                        return;\r\n                    }\r\n                    let { Data, Success } = await Post(\"/Recipe/CreateOrEdit\", formData);\r\n                    if (Success) {\r\n                        uni.showToast({\r\n                            title: \"操作成功\",\r\n                            icon: \"success\"\r\n                        });\r\n\r\n                        uni.navigateBack();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n    }).catch(err => {\r\n        uni.showToast({\r\n            title: \"请检测输入项是否正确\",\r\n            icon: \"none\"\r\n        });\r\n\r\n    });\r\n\r\n\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\"></style>","import MiniProgramPage from 'F:/workspace/HealthControl.uniapp/pages/Front/RecipeForm.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCommonStore","computed","reactive","ref","onLoad","onShow","onReady","Id","Post","nextTick","uni","res","MiniProgramPage"],"mappings":"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"}