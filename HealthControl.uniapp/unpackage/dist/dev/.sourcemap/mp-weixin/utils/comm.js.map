{"version":3,"file":"comm.js","sources":["utils/comm.js"],"sourcesContent":["export function CheckToken() {\r\n  if (!store.getters.Token) {\r\n    uni.navigateTo({\r\n      url: \"/pages/Front/Login\",\r\n    });\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n/**\r\n * 获取路径中的文件名称\r\n */\r\nexport function GetFileNameByPath(path) {\r\n  if (!path) {\r\n    return \"\";\r\n  }\r\n  var pos1 = path.lastIndexOf(\"/\");\r\n  var pos2 = path.lastIndexOf(\"\\\\\");\r\n  var pos = Math.max(pos1, pos2);\r\n  if (pos < 0) {\r\n    return path;\r\n  } else {\r\n    return path.substring(pos + 1);\r\n  }\r\n}\r\n/**\r\n * 获取路径中的文件格式\r\n */\r\nexport function GetFileTypeByPath(path) {\r\n  if (!path) {\r\n    return \"\";\r\n  }\r\n  var pos = path.lastIndexOf(\".\");\r\n  if (pos < 0) {\r\n    return \"\";\r\n  } else {\r\n    return path.substring(pos + 1);\r\n  }\r\n}\r\n/**\r\n * 切割字段返回一个集合\r\n * @param {*} value 需要切割字段\r\n * @param {*} cutting 切割的符号\r\n */\r\nexport function ConvertArray(value = \"\", cutting = \",\") {\r\n  if (!value) {\r\n    return [];\r\n  }\r\n  return value.split(cutting);\r\n}\r\n\r\n/**\r\n * 根据路径获取文件的详细信息\r\n */\r\nexport function FullConvertUrlArray(value = \"\", cutting = \",\") {\r\n  var arr = ConvertArray(value, cutting);\r\n\r\n  return arr.map((x) => {\r\n    return {\r\n      url: x,\r\n      name: GetFileNameByPath(x),\r\n      type: GetFileTypeByPath(x),\r\n    };\r\n  });\r\n}\r\n/**\r\n * 获取对象中指定key的值\r\n */\r\nexport function GetObjectValue(obj, name) {\r\n  if (!name) {\r\n    return undefined;\r\n  }\r\n  if (!obj) {\r\n    return undefined;\r\n  }\r\n  if (name.indexOf(\".\") != -1) {\r\n    var array = name.split(\".\");\r\n\r\n    var value = obj;\r\n    array.forEach((item) => {\r\n      value = value[`${item}`];\r\n    });\r\n    return value;\r\n  } else {\r\n    return obj[`${name}`];\r\n  }\r\n}\r\n/**\r\n * 根据某个字段进行去重\r\n */\r\nexport function UniqueBy(arr, key) {\r\n  return arr.reduce((acc, cur) => {\r\n    const existing = acc.find((item) => item[key] === cur[key]);\r\n    if (!existing) {\r\n      acc.push(cur);\r\n    }\r\n    return acc;\r\n  }, []);\r\n}\r\n// 年月日时分秒\r\nexport function GetFormatFullDate(date) {\r\n  let year = date.getFullYear();\r\n  let month = date.getMonth() + 1;\r\n  let day = date.getDate();\r\n  let hour = date.getHours();\r\n  let minutes = date.getMinutes();\r\n  let seconds = date.getSeconds();\r\n  month = month < 10 ? \"0\" + month : month;\r\n  day = day < 10 ? \"0\" + day : day;\r\n  hour = hour < 10 ? \"0\" + hour : hour;\r\n  minutes = minutes < 10 ? \"0\" + minutes : minutes;\r\n  seconds = seconds < 10 ? \"0\" + seconds : seconds;\r\n  let currentDate =\r\n    year + \"-\" + month + \"-\" + day + \" \" + hour + \":\" + minutes + \":\" + seconds;\r\n  return currentDate;\r\n}\r\n// 时分秒\r\nexport function GetFormatHMSDate(date) {\r\n  let year = date.getFullYear();\r\n  let month = date.getMonth() + 1;\r\n  let day = date.getDate();\r\n  let hour = date.getHours();\r\n  let minutes = date.getMinutes();\r\n  let seconds = date.getSeconds();\r\n  month = month < 10 ? \"0\" + month : month;\r\n  day = day < 10 ? \"0\" + day : day;\r\n  hour = hour < 10 ? \"0\" + hour : hour;\r\n  minutes = minutes < 10 ? \"0\" + minutes : minutes;\r\n  seconds = seconds < 10 ? \"0\" + seconds : seconds;\r\n  let currentDate = hour + \":\" + minutes + \":\" + seconds;\r\n  return currentDate;\r\n}\r\n// 年月日\r\nexport function GetFormatShortDate(date) {\r\n  let year = date.getFullYear();\r\n  let month = date.getMonth() + 1;\r\n  let day = date.getDate();\r\n  let hour = date.getHours();\r\n  let minutes = date.getMinutes();\r\n  let seconds = date.getSeconds();\r\n  month = month < 10 ? \"0\" + month : month;\r\n  day = day < 10 ? \"0\" + day : day;\r\n  hour = hour < 10 ? \"0\" + hour : hour;\r\n  minutes = minutes < 10 ? \"0\" + minutes : minutes;\r\n  seconds = seconds < 10 ? \"0\" + seconds : seconds;\r\n  let currentDate = year + \"-\" + month + \"-\" + day;\r\n\r\n  return currentDate;\r\n}\r\n\r\nexport function ShowLoading(title = \"加载中...\") {\r\n  return new Promise((resolve, reject) => {\r\n    uni.showLoading({\r\n      title: title,\r\n      success: resolve(),\r\n      fail: reject(),\r\n    });\r\n  });\r\n}\r\n\r\nexport function ShowModal(content = \"你确定要操作吗\") {\r\n  return new Promise((resolve, reject) => {\r\n    uni.showModal({\r\n      title: \"提示\",\r\n      content: content,\r\n      success: (res) => {\r\n        console.log(res);\r\n        resolve(res.confirm || false);\r\n      },\r\n      fail: (res) => {\r\n        resolve(false);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 选择图片\r\n */\r\nexport function ChooseImageAsync(count = 1) {\r\n  return new Promise((resolve, reject) => {\r\n    uni.chooseImage({\r\n      count: count, //默认9\r\n      sizeType: [\"original\", \"compressed\"], //可以指定是原图还是压缩图，默认二者都有\r\n      sourceType: [\"album\", \"camera\"], //从相册选择\r\n      success: (res) => {\r\n        resolve(res);\r\n      },\r\n    });\r\n  });\r\n}\r\n/**\r\n * 选择视频\r\n */\r\nexport function ChooseVideoAsync(count = 1) {\r\n  return new Promise((resolve, reject) => {\r\n    uni.chooseVideo({\r\n      sourceType: [\"album\", \"camera\"], //从相册选择\r\n      success: (res) => {\r\n        resolve(res);\r\n      },\r\n    });\r\n  });\r\n}\r\n/**\r\n * 得到登录的code\r\n */\r\nexport function GetLoginCode(count = 1) {\r\n  // #ifdef MP\r\n  return new Promise((resolve, reject) => {\r\n    console.log(\"aa\");\r\n    uni.login({\r\n      provider: \"weixin\",\r\n      onlyAuthorize: true, // 微信登录仅请求授权认证\r\n      success: function (event) {\r\n        console.log(\"得到登录的code\", event.code);\r\n        resolve(event.code);\r\n      },\r\n      fail: function (err) {\r\n        console.log(\"获取微信的登录状态code失败\", err);\r\n        reject(code);\r\n      },\r\n    });\r\n  });\r\n  // #endif\r\n\r\n  // #ifdef H5\r\n  return new Promise((resolve, reject) => {\r\n    console.log(\"执行\");\r\n    resolve(null);\r\n  });\r\n  // #endif\r\n}\r\n\r\nexport function ReturnPage(page = 1, ms = 1000) {\r\n  return new Promise((resolve, reject) => {\r\n    setTimeout(() => {\r\n      let pages = getCurrentPages();\r\n      if (pages.length == 1) {\r\n        uni.redirectTo({\r\n          url: \"/pages/Front/Index\",\r\n        });\r\n      } else {\r\n        uni.navigateBack({\r\n          delta: page,\r\n          success: (res) => {\r\n            resolve(res);\r\n          },\r\n        });\r\n      }\r\n    }, ms);\r\n  });\r\n}\r\n\r\nexport function GetTimeDifference(date) {\r\n  const now = new Date();\r\n  const diffInMilliseconds = now - date;\r\n  const diffInSeconds = Math.floor(diffInMilliseconds / 1000);\r\n  const diffInMinutes = Math.floor(diffInSeconds / 60);\r\n  const diffInHours = Math.floor(diffInMinutes / 60);\r\n  const diffInDays = Math.floor(diffInHours / 24);\r\n  const diffInMonths = Math.floor(diffInDays / 30);\r\n\r\n  if (diffInMonths > 0) {\r\n    return `${diffInMonths}个月前`;\r\n  } else if (diffInDays > 0) {\r\n    return `${diffInDays}天前`;\r\n  } else if (diffInHours > 0) {\r\n    return `${diffInHours}小时前`;\r\n  } else if (diffInMinutes > 0) {\r\n    return `${diffInMinutes}分钟前`;\r\n  } else {\r\n    return \"刚刚发表\";\r\n  }\r\n}\r\n\r\n/**\r\n * 获取当前经纬度\r\n */\r\nexport function GetCurrentLocation() {\r\n  return new Promise((resolve, reject) => {\r\n    uni.getLocation({\r\n      type: \"gcj02\", //返回可以用于uni.openLocation的经纬度\r\n      success: function (res) {\r\n        resolve(res);\r\n        console.log(res, \"res\");\r\n      },\r\n      fail: function (f) {\r\n        reject(f);\r\n      },\r\n    });\r\n  });\r\n}\r\n/**\r\n * 得到地址并写入缓存\r\n */\r\nexport async function SyncCurrentLocation() {\r\n  console.log(\"开始获取当前地址信息\");\r\n  let location = null;\r\n  await GetCurrentLocation()\r\n    .then(async (res) => {\r\n      if (res.latitude && res.longitude) {\r\n        location = {\r\n          latitude: res.latitude,\r\n          longitude: res.longitude,\r\n        };\r\n        await store.dispatch(\"SyncLocation\", location);\r\n      }\r\n    })\r\n    .catch((f) => {\r\n      uni.showToast({\r\n        icon: \"none\",\r\n        content: \"获取地址失败\",\r\n      });\r\n    });\r\n  return location;\r\n}\r\n\r\n/**\r\n * 表单验证\r\n * @param {Object} formRef\r\n */\r\nexport function formValid(formRef) {\r\n  return new Promise((resolve, reject) => {\r\n    formRef\r\n      .validate()\r\n      .then((res) => {\r\n        //如果验证失败\r\n        if (Array.isArray(res) == true) {\r\n          resolve({\r\n            Success: false,\r\n            Error: res,\r\n          });\r\n        } else {\r\n          resolve({\r\n            Success: true,\r\n            Data: res,\r\n          });\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        resolve({\r\n          Success: false,\r\n          Error: err,\r\n        });\r\n      });\r\n  });\r\n}\r\n/**\r\n * 二维码扫描\r\n */\r\nexport function ScanCode(page = 1, ms = 1000) {\r\n  return new Promise((resolve, reject) => {\r\n    uni.scanCode({\r\n      success(res) {\r\n        if (res.result) {\r\n          // 扫描成功，处理二维码内容\r\n          console.log(\"扫描结果：\", res.result);\r\n\r\n          resolve({\r\n            success: true,\r\n            result: res.result,\r\n          });\r\n        } else {\r\n          // 扫描失败\r\n          uni.showToast({\r\n            title: \"扫描失败\",\r\n            icon: \"none\",\r\n          });\r\n          reject({\r\n            success: false,\r\n          });\r\n        }\r\n      },\r\n      fail(f) {\r\n        reject({\r\n          success: false,\r\n        });\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 隐藏手机号\r\n * @param {string} phoneNumber 手机号\r\n * @returns {string} 隐藏后的手机号\r\n */\r\nexport function HidePhoneNumber(phoneNumber) {\r\n  if (!phoneNumber || phoneNumber.length != 11) {\r\n    return \"*\";\r\n  }\r\n  const prefix = phoneNumber.slice(0, 3);\r\n  const suffix = phoneNumber.slice(-4);\r\n  const hiddenPart = \"*\".repeat(4);\r\n  return prefix + hiddenPart + suffix;\r\n}\r\n"],"names":["uni"],"mappings":"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"}