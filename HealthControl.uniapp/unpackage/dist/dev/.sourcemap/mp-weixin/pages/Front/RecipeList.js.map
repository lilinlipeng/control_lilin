{"version":3,"file":"RecipeList.js","sources":["pages/Front/RecipeList.vue","../../HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvRnJvbnQvUmVjaXBlTGlzdC52dWU"],"sourcesContent":["<template>\r\n    <view>\r\n        <!-- 导航栏 -->\r\n        <uni-nav-bar dark :fixed=\"true\" shadow background-color=\"var(--primary-color)\" status-bar left-icon=\"left\"\r\n            left-text=\"返回\" @clickLeft=\"goBack\" title=\"食谱列表\" />\r\n\r\n        <!-- 内容区域 -->\r\n        <view class=\"content\">\r\n            <!-- 搜索栏 -->\r\n            <view class=\"search-bar\">\r\n                <uni-search-bar v-model=\"searchKeyWord\" placeholder=\"搜索食谱...\" @input=\"handleSearch\" />\r\n            </view>\r\n\r\n            <!-- 食谱列表 -->\r\n            <view class=\"recipe-list\">\r\n                <view v-for=\"recipe in RecipeList\" :key=\"recipe.Id\" class=\"recipe-card\" @click=\"goToDetail(recipe.Id)\">\r\n                    <!-- 封面图片 -->\r\n                    <view class=\"recipe-cover\">\r\n                        <image :src=\"recipe.Cover\" class=\"cover-image\" mode=\"aspectFill\" />\r\n                        <!-- 浏览量标签 -->\r\n                        <view class=\"view-count\">\r\n                            <uni-icons type=\"eye\" size=\"14\" color=\"#fff\" />\r\n                            <text class=\"count-text\">{{ recipe.ViewCount }}</text>\r\n                        </view>\r\n                    </view>\r\n\r\n                    <!-- 食谱信息 -->\r\n                    <view class=\"recipe-info\">\r\n                        <!-- 标题 -->\r\n                        <view class=\"recipe-title\">{{ recipe.Title }}</view>\r\n\r\n                        <!-- 描述内容（去除HTML标签） -->\r\n                        <view class=\"recipe-desc\">{{ getPlainText(recipe.Content) }}</view>\r\n\r\n                        <!-- 图片列表 -->\r\n                        <view v-if=\"recipe.imageList && recipe.imageList.length > 0\" class=\"image-list\">\r\n                            <image v-for=\"(img, index) in recipe.imageList\" :key=\"index\" :src=\"img\" class=\"small-image\"\r\n                                mode=\"aspectFill\" @click.stop=\"previewImage(img, recipe.imageList)\" />\r\n                        </view>\r\n\r\n                        <!-- 底部信息 -->\r\n                        <view class=\"recipe-bottom\">\r\n                            <view class=\"author-info\">\r\n                                <text class=\"author-name\">{{ recipe.PublishUserDto.Name }}</text>\r\n                                <text class=\"publish-time\">{{ formatTime(recipe.CreationTime) }}</text>\r\n                            </view>\r\n                            <view class=\"status-badge\" :class=\"getStatusClass(recipe.AuditStatus)\">\r\n                                {{ recipe.AuditStatusFormat }}\r\n                            </view>\r\n                        </view>\r\n                    </view>\r\n                </view>\r\n\r\n                <!-- 空状态 -->\r\n                <view v-if=\"RecipeList.length === 0\" class=\"empty-state\">\r\n                    <uni-icons type=\"info\" size=\"60\" color=\"#ccc\" />\r\n                    <text class=\"empty-text\">暂无食谱数据</text>\r\n                </view>\r\n            </view>\r\n\r\n            <!-- 加载更多 -->\r\n            <view v-if=\"RecipeList.length > 0\" class=\"load-more\">\r\n                <uni-load-more :status=\"loadStatus\" />\r\n            </view>\r\n        </view>\r\n    </view>\r\n</template>\r\n\r\n<script setup>\r\n\r\nimport { useCommonStore } from '@/store';\r\nimport { Post } from '@/utils/http';\r\nimport { onLoad, onReady, onShow } from \"@dcloudio/uni-app\";\r\nimport { computed, reactive, ref } from 'vue';\r\n\r\n// 获取store\r\nconst commonStore = useCommonStore();\r\nconst Token = computed(() => commonStore.Token)\r\nconst UserInfo = computed(() => commonStore.UserInfo)\r\nconst RoleType = computed(() => commonStore.RoleType)\r\nconst UserId = computed(() => commonStore.UserId)\r\n\r\n// 数据定义\r\nconst RecipeList = ref([]);\r\nconst searchKeyWord = ref('');\r\nconst loadStatus = ref('more'); // more, loading, noMore\r\n\r\nconst where = reactive({\r\n    KeyWord: ''\r\n});\r\n\r\n// 生命周期钩子\r\nonLoad(async (option) => {\r\n});\r\n\r\nonShow(async () => {\r\n    GetRecipeListApi();\r\n});\r\n\r\nonReady(async () => {\r\n});\r\n\r\n// 方法\r\nconst goBack = () => {\r\n    uni.navigateBack();\r\n};\r\n\r\n// 获取食谱列表\r\nconst GetRecipeListApi = async () => {\r\n    try {\r\n        loadStatus.value = 'loading';\r\n        let {\r\n            Data: {\r\n                Items\r\n            }\r\n        } = await Post('/Recipe/List', where);\r\n\r\n        // 预处理每个食谱的图片列表\r\n        const processedItems = Items.map(recipe => ({\r\n            ...recipe,\r\n            imageList: recipe.ImageUrls ? recipe.ImageUrls.split(',').filter(url => url.trim()).slice(0, 4) : []\r\n        }));\r\n\r\n        RecipeList.value = processedItems;\r\n        loadStatus.value = Items.length > 0 ? 'more' : 'noMore';\r\n    } catch (error) {\r\n        console.error('获取食谱列表失败:', error);\r\n        loadStatus.value = 'more';\r\n    }\r\n}\r\n\r\n// 搜索处理\r\nconst handleSearch = (value) => {\r\n    where.KeyWord = value;\r\n    GetRecipeListApi();\r\n};\r\n\r\n\r\n\r\n// 跳转到详情页\r\nconst goToDetail = (id) => {\r\n    uni.navigateTo({\r\n        url: `/pages/Front/RecipeDetail?RecipeId=${id}`\r\n    });\r\n};\r\n\r\n// 获取纯文本内容（去除HTML标签）\r\nconst getPlainText = (htmlContent) => {\r\n    if (!htmlContent) return '';\r\n    // 简单的HTML标签去除\r\n    return htmlContent.replace(/<[^>]*>/g, '').substring(0, 100) + '...';\r\n};\r\n\r\n// 格式化时间\r\nconst formatTime = (timeStr) => {\r\n    if (!timeStr) return '';\r\n    const date = new Date(timeStr);\r\n    const now = new Date();\r\n    const diff = now - date;\r\n\r\n    if (diff < 60000) return '刚刚';\r\n    if (diff < 3600000) return Math.floor(diff / 60000) + '分钟前';\r\n    if (diff < 86400000) return Math.floor(diff / 3600000) + '小时前';\r\n    if (diff < 2592000000) return Math.floor(diff / 86400000) + '天前';\r\n\r\n    return timeStr.split(' ')[0]; // 返回日期部分\r\n};\r\n\r\n// 获取状态样式类\r\nconst getStatusClass = (status) => {\r\n    switch (status) {\r\n        case 1: return 'status-pending';\r\n        case 2: return 'status-approved';\r\n        case 3: return 'status-rejected';\r\n        default: return 'status-pending';\r\n    }\r\n};\r\n\r\n// 预览图片\r\nconst previewImage = (current, urls) => {\r\n    uni.previewImage({\r\n        current: current,\r\n        urls: urls\r\n    });\r\n};\r\n\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n/* 页面整体样式 */\r\n.content {\r\n    background-color: #f5f5f5;\r\n    min-height: 100vh;\r\n}\r\n\r\n/* 搜索栏样式 */\r\n.search-bar {\r\n    padding: 20rpx;\r\n    background-color: #fff;\r\n    margin-bottom: 20rpx;\r\n}\r\n\r\n/* 食谱列表样式 */\r\n.recipe-list {\r\n    padding: 0 20rpx;\r\n}\r\n\r\n/* 食谱卡片样式 */\r\n.recipe-card {\r\n    background-color: #fff;\r\n    border-radius: 16rpx;\r\n    margin-bottom: 20rpx;\r\n    overflow: hidden;\r\n    box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n    transition: transform 0.3s ease;\r\n}\r\n\r\n.recipe-card:active {\r\n    transform: scale(0.98);\r\n    /* 点击效果 */\r\n}\r\n\r\n/* 封面图片区域 */\r\n.recipe-cover {\r\n    position: relative;\r\n    height: 360rpx;\r\n    overflow: hidden;\r\n}\r\n\r\n.cover-image {\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: cover;\r\n}\r\n\r\n/* 浏览量标签 */\r\n.view-count {\r\n    position: absolute;\r\n    top: 20rpx;\r\n    right: 20rpx;\r\n    background-color: rgba(0, 0, 0, 0.6);\r\n    padding: 8rpx 16rpx;\r\n    border-radius: 20rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8rpx;\r\n}\r\n\r\n.count-text {\r\n    color: #fff;\r\n    font-size: 24rpx;\r\n}\r\n\r\n/* 食谱信息区域 */\r\n.recipe-info {\r\n    padding: 24rpx;\r\n}\r\n\r\n/* 食谱标题 */\r\n.recipe-title {\r\n    font-size: 32rpx;\r\n    font-weight: 600;\r\n    color: #333;\r\n    margin-bottom: 16rpx;\r\n    line-height: 1.4;\r\n}\r\n\r\n/* 食谱描述 */\r\n.recipe-desc {\r\n    font-size: 28rpx;\r\n    color: #666;\r\n    line-height: 1.5;\r\n    margin-bottom: 16rpx;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    display: -webkit-box;\r\n    -webkit-line-clamp: 2;\r\n    -webkit-box-orient: vertical;\r\n}\r\n\r\n/* 图片列表样式 */\r\n.image-list {\r\n    display: flex;\r\n    gap: 12rpx;\r\n    margin-bottom: 20rpx;\r\n    overflow-x: auto;\r\n}\r\n\r\n.small-image {\r\n    width: 120rpx;\r\n    height: 120rpx;\r\n    border-radius: 12rpx;\r\n    flex-shrink: 0;\r\n    border: 2rpx solid #f0f0f0;\r\n    transition: transform 0.2s ease;\r\n}\r\n\r\n.small-image:active {\r\n    transform: scale(0.95);\r\n}\r\n\r\n/* 底部信息 */\r\n.recipe-bottom {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n}\r\n\r\n/* 作者信息 */\r\n.author-info {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 8rpx;\r\n}\r\n\r\n.author-name {\r\n    font-size: 26rpx;\r\n    color: #333;\r\n    font-weight: 500;\r\n}\r\n\r\n.publish-time {\r\n    font-size: 24rpx;\r\n    color: #999;\r\n}\r\n\r\n/* 状态标签 */\r\n.status-badge {\r\n    padding: 8rpx 16rpx;\r\n    border-radius: 20rpx;\r\n    font-size: 24rpx;\r\n    font-weight: 500;\r\n}\r\n\r\n.status-pending {\r\n    background-color: #fff3cd;\r\n    color: #856404;\r\n    border: 1px solid #ffeaa7;\r\n}\r\n\r\n.status-approved {\r\n    background-color: #d4edda;\r\n    color: #155724;\r\n    border: 1px solid #c3e6cb;\r\n}\r\n\r\n.status-rejected {\r\n    background-color: #f8d7da;\r\n    color: #721c24;\r\n    border: 1px solid #f5c6cb;\r\n}\r\n\r\n/* 空状态样式 */\r\n.empty-state {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding: 120rpx 40rpx;\r\n    color: #999;\r\n}\r\n\r\n.empty-text {\r\n    font-size: 28rpx;\r\n    margin-top: 20rpx;\r\n}\r\n\r\n/* 加载更多样式 */\r\n.load-more {\r\n    padding: 40rpx 0;\r\n}\r\n\r\n/* 响应式适配 */\r\n@media screen and (max-width: 750rpx) {\r\n    .recipe-card {\r\n        margin-bottom: 16rpx;\r\n    }\r\n\r\n    .recipe-cover {\r\n        height: 320rpx;\r\n    }\r\n\r\n    .recipe-title {\r\n        font-size: 30rpx;\r\n    }\r\n\r\n    .recipe-desc {\r\n        font-size: 26rpx;\r\n    }\r\n}\r\n</style>","import MiniProgramPage from 'F:/workspace/HealthControl.uniapp/pages/Front/RecipeList.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCommonStore","computed","ref","reactive","onLoad","onShow","onReady","uni","Post"],"mappings":";;;;;;;;;;;;;;;;;;;;;AA4EA,UAAM,cAAcA,YAAc,eAAA;AACpBC,kBAAAA,SAAS,MAAM,YAAY,KAAK;AAC7BA,kBAAAA,SAAS,MAAM,YAAY,QAAQ;AACnCA,kBAAAA,SAAS,MAAM,YAAY,QAAQ;AACrCA,kBAAAA,SAAS,MAAM,YAAY,MAAM;AAGhD,UAAM,aAAaC,cAAAA,IAAI,CAAA,CAAE;AACzB,UAAM,gBAAgBA,cAAAA,IAAI,EAAE;AAC5B,UAAM,aAAaA,cAAAA,IAAI,MAAM;AAE7B,UAAM,QAAQC,cAAAA,SAAS;AAAA,MACnB,SAAS;AAAA,IACb,CAAC;AAGDC,kBAAM,OAAC,OAAO,WAAW;AAAA,IACzB,CAAC;AAEDC,kBAAAA,OAAO,YAAY;AACf;IACJ,CAAC;AAEDC,kBAAAA,QAAQ,YAAY;AAAA,IACpB,CAAC;AAGD,UAAM,SAAS,MAAM;AACjBC,oBAAG,MAAC,aAAY;AAAA,IACpB;AAGA,UAAM,mBAAmB,YAAY;AACjC,UAAI;AACA,mBAAW,QAAQ;AACnB,YAAI;AAAA,UACA,MAAM;AAAA,YACF;AAAA,UACH;AAAA,QACJ,IAAG,MAAMC,WAAI,KAAC,gBAAgB,KAAK;AAGpC,cAAM,iBAAiB,MAAM,IAAI,aAAW;AAAA,UACxC,GAAG;AAAA,UACH,WAAW,OAAO,YAAY,OAAO,UAAU,MAAM,GAAG,EAAE,OAAO,SAAO,IAAI,MAAM,EAAE,MAAM,GAAG,CAAC,IAAI,CAAE;AAAA,QACvG,EAAC;AAEF,mBAAW,QAAQ;AACnB,mBAAW,QAAQ,MAAM,SAAS,IAAI,SAAS;AAAA,MAClD,SAAQ,OAAO;AACZD,sBAAA,MAAA,MAAA,SAAA,qCAAc,aAAa,KAAK;AAChC,mBAAW,QAAQ;AAAA,MACtB;AAAA,IACL;AAGA,UAAM,eAAe,CAAC,UAAU;AAC5B,YAAM,UAAU;AAChB;IACJ;AAKA,UAAM,aAAa,CAAC,OAAO;AACvBA,oBAAAA,MAAI,WAAW;AAAA,QACX,KAAK,sCAAsC,EAAE;AAAA,MACrD,CAAK;AAAA,IACL;AAGA,UAAM,eAAe,CAAC,gBAAgB;AAClC,UAAI,CAAC;AAAa,eAAO;AAEzB,aAAO,YAAY,QAAQ,YAAY,EAAE,EAAE,UAAU,GAAG,GAAG,IAAI;AAAA,IACnE;AAGA,UAAM,aAAa,CAAC,YAAY;AAC5B,UAAI,CAAC;AAAS,eAAO;AACrB,YAAM,OAAO,IAAI,KAAK,OAAO;AAC7B,YAAM,MAAM,oBAAI;AAChB,YAAM,OAAO,MAAM;AAEnB,UAAI,OAAO;AAAO,eAAO;AACzB,UAAI,OAAO;AAAS,eAAO,KAAK,MAAM,OAAO,GAAK,IAAI;AACtD,UAAI,OAAO;AAAU,eAAO,KAAK,MAAM,OAAO,IAAO,IAAI;AACzD,UAAI,OAAO;AAAY,eAAO,KAAK,MAAM,OAAO,KAAQ,IAAI;AAE5D,aAAO,QAAQ,MAAM,GAAG,EAAE,CAAC;AAAA,IAC/B;AAGA,UAAM,iBAAiB,CAAC,WAAW;AAC/B,cAAQ,QAAM;AAAA,QACV,KAAK;AAAG,iBAAO;AAAA,QACf,KAAK;AAAG,iBAAO;AAAA,QACf,KAAK;AAAG,iBAAO;AAAA,QACf;AAAS,iBAAO;AAAA,MACnB;AAAA,IACL;AAGA,UAAM,eAAe,CAAC,SAAS,SAAS;AACpCA,oBAAAA,MAAI,aAAa;AAAA,QACb;AAAA,QACA;AAAA,MACR,CAAK;AAAA,IACL;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvLA,GAAG,WAAW,eAAe;"}