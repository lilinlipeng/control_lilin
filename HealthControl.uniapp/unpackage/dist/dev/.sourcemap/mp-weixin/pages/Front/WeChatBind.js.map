{"version":3,"file":"WeChatBind.js","sources":["pages/Front/WeChatBind.vue","../../HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvRnJvbnQvV2VDaGF0QmluZC52dWU"],"sourcesContent":["<template>\n    <view>\n        <!-- 顶部导航栏 -->\n        <uni-nav-bar dark :fixed=\"true\" shadow background-color=\"var(--primary-color)\" status-bar left-icon=\"left\"\n            left-text=\"返回\" @clickLeft=\"goBack\" title=\"微信绑定\" />\n\n        <!-- 主体内容 -->\n        <view class=\"container\">\n            <!-- 微信图标和标题 -->\n            <view class=\"header-section\">\n                <uni-icons type=\"weixin\" size=\"80\" color=\"#07c160\"></uni-icons>\n                <text class=\"title\">微信绑定</text>\n                <text class=\"subtitle\">绑定微信账号，享受更便捷的登录体验</text>\n            </view>\n\n            <!-- 绑定状态卡片 -->\n            <view class=\"status-card\">\n                <view class=\"status-header\">\n                    <text class=\"status-title\">绑定状态</text>\n                    <uni-badge :text=\"bindStatus\" :type=\"isWechatBound ? 'success' : 'warning'\" size=\"normal\">\n                    </uni-badge>\n                </view>\n\n                <!-- OpenId 显示 -->\n                <view class=\"openid-section\" v-if=\"OpenId\">\n                    <text class=\"openid-label\">微信OpenId:</text>\n                    <text class=\"openid-value\">{{ maskedOpenId }}</text>\n                </view>\n\n                <!-- 绑定信息 -->\n                <view class=\"bind-info\" v-if=\"isWechatBound\">\n                    <text class=\"bind-status\">✅ 微信账号已绑定</text>\n                </view>\n            </view>\n\n            <!-- 操作按钮 -->\n            <view class=\"action-section\">\n                <button v-if=\"!isWechatBound\" class=\"bind-btn\" type=\"primary\" size=\"default\" :loading=\"isBinding\"\n                    :disabled=\"isBinding\" @click=\"BindWechatApi\">\n                    {{ isBinding ? '绑定中...' : '绑定微信' }}\n                </button>\n\n                <button v-else class=\"unbind-btn\" type=\"warn\" size=\"default\" :loading=\"isUnbinding\"\n                    @click=\"UnbindWechatApi\">\n                    {{ isUnbinding ? '解绑中...' : '解绑微信' }}\n                </button>\n            </view>\n\n            <!-- 提示信息 -->\n            <view class=\"tips-section\">\n                <uni-card :is-shadow=\"false\" spacing=\"0\">\n                    <text slot=\"title\" class=\"tips-title\">温馨提示</text>\n                    <view class=\"tips-content\">\n                        <view class=\"tip-item\">\n                            <uni-icons type=\"info-filled\" size=\"16\" color=\"#909399\"></uni-icons>\n                            <text>绑定后可使用微信快速登录</text>\n                        </view>\n                        <view class=\"tip-item\">\n                            <uni-icons type=\"info-filled\" size=\"16\" color=\"#909399\"></uni-icons>\n                            <text>解绑后将无法使用微信登录</text>\n                        </view>\n                        <view class=\"tip-item\" v-if=\"!OpenId\">\n                            <uni-icons type=\"info-filled\" size=\"16\" color=\"#f56c6c\"></uni-icons>\n                            <text>需要先获取微信OpenId才能进行绑定</text>\n                        </view>\n                    </view>\n                </uni-card>\n            </view>\n        </view>\n    </view>\n</template>\n\n<script setup>\n\nimport { useCommonStore } from '@/store';\nimport { Post } from \"@/utils/http\";\nimport { onLoad, onReady, onShow } from \"@dcloudio/uni-app\";\nimport { computed, nextTick, reactive, ref } from 'vue';\n\n// 获取store\nconst commonStore = useCommonStore();\nconst Token = computed(() => commonStore.Token)\nconst UserInfo = computed(() => commonStore.UserInfo)\nconst RoleType = computed(() => commonStore.RoleType)\nconst UserId = computed(() => commonStore.UserId)\nconst OpenId = computed(() => commonStore.UserInfo.OpenId)\n\n// 响应式数据\nconst isBinding = ref(false);\nconst isUnbinding = ref(false);\n\n// 计算属性\nconst isWechatBound = computed(() => {\n    // 根据UserInfo中是否有OpenId来判断是否已绑定微信\n    return OpenId.value && OpenId.value.trim() !== '';\n});\n\nconst bindStatus = computed(() => {\n    return isWechatBound.value ? '已绑定' : '未绑定';\n});\n\nconst maskedOpenId = computed(() => {\n    if (!OpenId.value) return '';\n    const openId = OpenId.value;\n    if (openId.length <= 8) return openId;\n\n    // 显示前4位和后4位，中间用****替换\n    const start = openId.substring(0, 4);\n    const end = openId.substring(openId.length - 4);\n    return `${start}****${end}`;\n});\n\n// 移除formatBindTime，因为我们只需要判断OpenId是否存在\n\n// 生命周期钩子\nonLoad(async (option) => {\n    // 页面加载时可以刷新用户信息\n    await commonStore.GetInfo();\n});\n\nonShow(async () => {\n    // 页面显示时的逻辑\n});\n\nonReady(async () => {\n\n});\n\nconst BindWechatApi = async () => {\n    console.log('BindWechatApi', UserId.value);\n    isBinding.value = true;\n    //调用uniapp的微信登录接口 获取code\n    uni.login({\n        \"provider\": \"weixin\",\n        \"onlyAuthorize\": true, // 微信登录仅请求授权认证\n        success: async (res) => {\n\n            const { Data } = await Post(`/User/BindWechat`, { WxCode: res.code, Id: UserId.value });\n            //刷新store的getUserInfo\n            await commonStore.GetInfo();\n            isBinding.value = false;\n        },\n        fail: (res) => {\n            isBinding.value = false;\n            console.log(res);\n        }\n    });\n\n\n}\n\nconst UnbindWechatApi = async () => {\n    // 显示确认对话框\n\n    uni.showModal({\n        title: '确认解绑',\n        content: '解绑后将无法使用微信快速登录，确定要解绑吗？',\n        success: async (res) => {\n\n            const { Data } = await Post(`/User/UnbindWechat`, { Id: UserId.value });\n            //刷新store的getUserInfo\n            await commonStore.GetInfo();\n        }\n    });\n\n\n\n}\n\n\n\n\n// 方法\nconst goBack = () => {\n    uni.navigateBack();\n};\n\n</script>\n\n<style scoped lang=\"scss\">\n.container {\n    padding: 20upx;\n    background-color: #f5f5f5;\n    min-height: 100vh;\n}\n\n/* 头部区域样式 */\n.header-section {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 60upx 0 40upx 0;\n    background-color: #fff;\n    border-radius: 20upx;\n    margin-bottom: 30upx;\n\n    .title {\n        font-size: 36upx;\n        font-weight: bold;\n        color: #333;\n        margin-top: 20upx;\n    }\n\n    .subtitle {\n        font-size: 28upx;\n        color: #666;\n        margin-top: 10upx;\n        text-align: center;\n    }\n}\n\n/* 状态卡片样式 */\n.status-card {\n    background-color: #fff;\n    border-radius: 20upx;\n    padding: 30upx;\n    margin-bottom: 30upx;\n\n    .status-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 20upx;\n\n        .status-title {\n            font-size: 32upx;\n            font-weight: bold;\n            color: #333;\n        }\n    }\n\n    .openid-section {\n        margin-bottom: 20upx;\n\n        .openid-label {\n            font-size: 28upx;\n            color: #666;\n            display: block;\n            margin-bottom: 10upx;\n        }\n\n        .openid-value {\n            font-size: 30upx;\n            color: #333;\n            font-family: monospace;\n            background-color: #f8f9fa;\n            padding: 15upx 20upx;\n            border-radius: 10upx;\n            display: block;\n        }\n    }\n\n    .bind-info {\n        .bind-status {\n            font-size: 28upx;\n            color: #07c160;\n            font-weight: 500;\n        }\n    }\n}\n\n/* 操作按钮样式 */\n.action-section {\n    margin-bottom: 30upx;\n\n    .bind-btn,\n    .unbind-btn {\n        width: 100%;\n        height: 88upx;\n        border-radius: 44upx;\n        font-size: 32upx;\n        font-weight: bold;\n    }\n\n    .bind-btn {\n        background: linear-gradient(135deg, #07c160, #06ad56);\n        border: none;\n    }\n\n    .unbind-btn {\n        background: linear-gradient(135deg, #f56c6c, #e85656);\n        border: none;\n    }\n}\n\n/* 提示信息样式 */\n.tips-section {\n    .tips-title {\n        font-size: 30upx;\n        font-weight: bold;\n        color: #333;\n    }\n\n    .tips-content {\n        .tip-item {\n            display: flex;\n            align-items: center;\n            margin-bottom: 15upx;\n            font-size: 26upx;\n            color: #666;\n\n            uni-icons {\n                margin-right: 10upx;\n                flex-shrink: 0;\n            }\n\n            &:last-child {\n                margin-bottom: 0;\n            }\n        }\n    }\n}\n</style>","import MiniProgramPage from 'F:/workspace/HealthControl.uniapp/pages/Front/WeChatBind.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCommonStore","computed","ref","onLoad","onShow","onReady","uni","Post"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAgFA,UAAM,cAAcA,YAAc,eAAA;AACpBC,kBAAAA,SAAS,MAAM,YAAY,KAAK;AAC7BA,kBAAAA,SAAS,MAAM,YAAY,QAAQ;AACnCA,kBAAAA,SAAS,MAAM,YAAY,QAAQ;AACpD,UAAM,SAASA,cAAQ,SAAC,MAAM,YAAY,MAAM;AAChD,UAAM,SAASA,cAAAA,SAAS,MAAM,YAAY,SAAS,MAAM;AAGzD,UAAM,YAAYC,cAAAA,IAAI,KAAK;AAC3B,UAAM,cAAcA,cAAAA,IAAI,KAAK;AAG7B,UAAM,gBAAgBD,cAAQ,SAAC,MAAM;AAEjC,aAAO,OAAO,SAAS,OAAO,MAAM,KAAM,MAAK;AAAA,IACnD,CAAC;AAED,UAAM,aAAaA,cAAQ,SAAC,MAAM;AAC9B,aAAO,cAAc,QAAQ,QAAQ;AAAA,IACzC,CAAC;AAED,UAAM,eAAeA,cAAQ,SAAC,MAAM;AAChC,UAAI,CAAC,OAAO;AAAO,eAAO;AAC1B,YAAM,SAAS,OAAO;AACtB,UAAI,OAAO,UAAU;AAAG,eAAO;AAG/B,YAAM,QAAQ,OAAO,UAAU,GAAG,CAAC;AACnC,YAAM,MAAM,OAAO,UAAU,OAAO,SAAS,CAAC;AAC9C,aAAO,GAAG,KAAK,OAAO,GAAG;AAAA,IAC7B,CAAC;AAKDE,kBAAM,OAAC,OAAO,WAAW;AAErB,YAAM,YAAY;IACtB,CAAC;AAEDC,kBAAAA,OAAO,YAAY;AAAA,IAEnB,CAAC;AAEDC,kBAAAA,QAAQ,YAAY;AAAA,IAEpB,CAAC;AAED,UAAM,gBAAgB,YAAY;AAC9BC,oBAAA,MAAA,MAAA,OAAA,qCAAY,iBAAiB,OAAO,KAAK;AACzC,gBAAU,QAAQ;AAElBA,oBAAAA,MAAI,MAAM;AAAA,QACN,YAAY;AAAA,QACZ,iBAAiB;AAAA;AAAA,QACjB,SAAS,OAAO,QAAQ;AAEH,gBAAMC,gBAAK,oBAAoB,EAAE,QAAQ,IAAI,MAAM,IAAI,OAAO,OAAO;AAEtF,gBAAM,YAAY;AAClB,oBAAU,QAAQ;AAAA,QACrB;AAAA,QACD,MAAM,CAAC,QAAQ;AACX,oBAAU,QAAQ;AAClBD,wBAAAA,MAAY,MAAA,OAAA,qCAAA,GAAG;AAAA,QAClB;AAAA,MACT,CAAK;AAAA,IAGL;AAEA,UAAM,kBAAkB,YAAY;AAGhCA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,OAAO,QAAQ;AAEH,gBAAMC,WAAAA,KAAK,sBAAsB,EAAE,IAAI,OAAO,OAAO;AAEtE,gBAAM,YAAY;QACrB;AAAA,MACT,CAAK;AAAA,IAIL;AAMA,UAAM,SAAS,MAAM;AACjBD,oBAAG,MAAC,aAAY;AAAA,IACpB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9KA,GAAG,WAAW,eAAe;"}